# app.py
from flask import Flask, request, jsonify
from flask_cors import CORS # Import CORS
from rag_utils import load_documents, search
import os
import openai
from dotenv import load_dotenv
import requests

load_dotenv()

AZURE_ENDPOINT = os.getenv("AZURE_OPENAI_ENDPOINT")
AZURE_API_KEY = os.getenv("AZURE_OPENAI_API_KEY")
AZURE_DEPLOYMENT = os.getenv("AZURE_DEPLOYMENT_NAME")
AZURE_API_VERSION = os.getenv("AZURE_OPENAI_API_VERSION")

app = Flask(__name__)
CORS(app) # Add this line to enable CORS for your app

# IMPORTANT: Initialize RAG model within an app context if load_documents
# relies on it, or ensure it's called once before requests are handled.
# Calling it directly at the module level is fine for simple cases,
# but consider using app.before_first_request for more complex setups.
@app.route('/')
def home():
    return "LegalEase Flask API is running! Access /ask for RAG functionality."


try:
    load_documents()
    print("RAG model initialized successfully.")
except FileNotFoundError:
    print("Error: 'bareacts.txt' not found. Please ensure it's in the 'legal_data/' directory.")
    # Optionally, exit or disable AI features if data isn't loaded
except Exception as e:
    print(f"Error initializing RAG model: {e}")

# ... rest of your app.py ...

if __name__ == "__main__":
    # Ensure Flask runs on port 5000, matching apiservice.jsx
    app.run(debug=True, host='0.0.0.0', port=5000)